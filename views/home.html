<html>
  <head>
    <title>Hull <%= name %></title>
    <link rel="stylesheet" href="//dd04rofzygnm0.cloudfront.net/releases/master/865f04865d2448286626bac92c518a8f8ea8bafe/stylesheets/neue.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
  </head>
  <body>
    <div class="row">
      <div class="col-md-6 col-md-offset-3 col-sm-offset-2 col-sm-8 col-xs-offset-1 col-xs-10 mt-2 panel">
        <div class="panel-body">
          <div class="mb-1">
            <h1 class="mb-0 mt-05  text-center"><i class="icon icon-hull" style="font-size:64px;"></i></h1>
            <div class="mb-1 media ps-4 pb-1">
              <div class="center-block col-xs-12">
                <p class="center-block mb-1 text-center">
                  Fetch recently updated Close.io Leads and linked Contacts. When run just after installing the connector, it will fetch last 2 days, otherwise it will fetch recent leads.
                </p>
                <div data-href="/fetch-recent-leads" class="center-block btn btn-rounded btn-pill btn-primary">Fetch Recently Updated Leads</div>

                <p>Export</p>
                <% if (pendingExport && pendingExport.progress && pendingExport.total) { %>
                <p>You have got a pending export:<br />
                  Close.io progress: <%= pendingExport.progress %> / <%= pendingExport.total %><br />
                  Close.io status: <%= pendingExport.status %><br />
                  <% if (pendingExport.status === "done") { %>
                  Close.io done processing their export but data is still being processed by Hull.<br />
                  <% } %>
                  You won't be able to trigger new export before the pending is finished.
                </p>
                <% } else { %>
                <div data-href-export="/trigger-leads-export" class="center-block btn btn-rounded btn-pill btn-primary">Trigger a full leads export</div>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>window.hullAuthCompleted = function authCompleted() { window.location.href = window.location.href.replace("&reset=true",""); };</script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script>
      jQuery(function($) {
        $("[data-href]").click(function() {
          var url = $(this).attr('data-href');
          swal({
            title: "Fetch recently updated leads",
            text: "You are going to fetch your recent Close.io Leads and linked Contacts. This can generate a lot of traffic. Are you sure?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, fetch all!",
            closeOnConfirm: false
          }, function(isConfirm) {
            if (isConfirm) {
              $.post(url+window.location.search);
              swal("Fetching started", "The Leads and Contacts will be fetched shortly.", "success");
            }
          });
        });

        $("[data-href-export]").click(function() {
          var url = $(this).attr('data-href-export');
          swal({
            title: "Trigger full leads export",
            text: "You are going to fetch your recent Close.io Leads and linked Contacts. This can generate a lot of traffic. Are you sure?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, fetch all!",
            closeOnConfirm: false
          }, function(isConfirm) {
            if (isConfirm) {
              $.post(url+window.location.search);
              swal("Fetching started", "The Leads and Contacts will be fetched shortly.", "success");
            }
          });
        });
      });
    </script>

    <style type="text/css" media="screen">
      .check i.icon {
        color: rgba(75, 222, 122, 0.52);
        font-size: 2pc;
        position: relative;
        top: -11px;
        left: 3px;
      }
      .check.valid {
        border-color: rgba(75, 222, 122, 0.52);
      }
      .check {
        border-radius: 100px;
        border: 2px solid transparent;
        padding: 0 5px;
        height: 37px;
        width: 37px;
        position: relative;
      }
    </style>
  </body>
  </html>
